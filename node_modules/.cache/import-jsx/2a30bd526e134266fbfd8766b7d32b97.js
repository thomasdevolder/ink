'use strict';

var utils = require('readline-utils');

var repeat = require('repeat-string');

const React = require("react");

const SnakeComp = () => {
  var windowSize = require('window-size');

  var size = windowSize.height - 10;
  var score = 0;
  var head = '^';
  var body = []; // borders are from cli-table chars: https://github.com/Automattic/cli-table/blob/master/lib/index.js#L21-L37

  var borders = {
    'top': '─',
    'top-mid': '┬',
    'top-left': '┌',
    'top-right': '┐',
    'bottom': '─',
    'bottom-mid': '┴',
    'bottom-left': '└',
    'bottom-right': '┘',
    'left': '│',
    'left-mid': '├',
    'mid': '─',
    'mid-mid': '┼',
    'right': '│',
    'right-mid': '┤',
    'middle': '│'
  };
  var center = [Math.floor(windowSize.width / 2), Math.floor(windowSize.height / 2)];
  var len = 1;
  var direction = [0, -1];
  var position, board;

  function render() {
    rl.output.unmute();
    utils.clearScreen(rl);
    var output = '';
    var top = center[1] - Math.floor(size / 2);
    var left = center[0] - size;
    output += '\n' + repeat(' ', left) + score + '\n';
    output += repeat('\n', top - 2);
    output += repeat(' ', left);
    output += borders['top-left'] + repeat(borders.top, size * 2) + borders['top-right'] + '\n';

    for (var row = 0; row < board.length; row++) {
      output += repeat(' ', left) + borders.left;

      for (var col = 0; col < board[row].length; col++) {
        output += ' ' + board[row][col];
      }

      output += borders.right + '\n';
    }

    output += repeat(' ', left);
    output += borders['bottom-left'] + repeat(borders.bottom, size * 2) + borders['bottom-right'] + '\n';
    rl.output.write(output);
    rl.output.mute();
  }

  function move(event) {
    if (!event) return;

    switch (event.key.name) {
      case 'right':
        direction = [1, 0];
        head = '>';
        break;

      case 'left':
        direction = [-1, 0];
        head = '<';
        break;

      case 'up':
        direction = [0, -1];
        head = '^';
        break;

      case 'down':
        direction = [0, 1];
        head = 'v';
        break;
    }
  }

  function reset() {
    score = 0;
    len = 1;
    body = [];
    position = [Math.floor(size / 2), Math.floor(size / 2)];
    board = new Array(size);

    for (var i = 0; i < board.length; i++) {
      board[i] = new Array(size);

      for (var j = 0; j < board[i].length; j++) {
        board[i][j] = ' ';
      }
    }

    board[position[1]][position[0]] = head;
  }

  function tick() {
    board[position[1]][position[0]] = ' ';
    position[0] += direction[0];
    position[1] += direction[1];

    if (position[0] >= size || position[1] >= size || position[0] < 0 || position[1] < 0) {
      reset();
      return;
    }

    if (board[position[1]][position[0]] === '@') {
      score++;
      len++;

      if (body.length) {
        body.push(position.slice());
      }
    } else if (board[position[1]][position[0]] !== ' ') {
      reset();
      return;
    }

    board[position[1]][position[0]] = head;
    body.reduce(function (acc, curr, i, arr) {
      var tail = 'X';
      var prev = i === 0 ? position : arr[i - 1];
      var next = i === arr.length - 1 ? null : arr[i + 1];

      if (prev[0] === curr[0]) {
        if (next) {
          if (next[0] === curr[0]) tail = borders.middle;else if (next[0] > curr[0]) {
            if (prev[1] < curr[1]) tail = borders['bottom-left'];else tail = borders['top-left'];
          } else {
            if (prev[1] < curr[1]) tail = borders['bottom-right'];else tail = borders['top-right'];
          }
        } else {
          tail = borders.middle;
        }
      } else if (prev[1] === curr[1]) {
        if (next) {
          if (next[1] === curr[1]) tail = borders.mid;else if (next[1] > curr[1]) {
            if (prev[0] > curr[0]) tail = borders['top-left'];else tail = borders['top-right'];
          } else {
            if (prev[0] > curr[0]) tail = borders['bottom-left'];else tail = borders['bottom-right'];
          }
        } else {
          tail = borders.mid;
        }
      }

      board[curr[1]][curr[0]] = tail;
    }, []);
    body.unshift(position.slice());

    while (body.length > len) {
      var part = body.pop();
      board[part[1]][part[0]] = ' ';
    }

    render();
  }

  function apple() {
    var x = Math.floor(Math.random() * size);
    var y = Math.floor(Math.random() * size);
    board[y][x] = '@';
  }

  var rl = utils.createInterface();
  var width = utils.cliWidth(rl);
  rl.setPrompt('');
  utils.hideCursor(rl);
  rl.input.on('keypress', function (str, key) {
    var event = utils.normalize(str, key);
    move(event);
  });
  rl.on('line', function (line) {
    console.log('line', line);
  });
  rl.output.mute();
  reset();
  render();
  setInterval(tick, 200);
  setInterval(apple, 2000);
};

module.exports = SnakeComp;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNuYWtlQ29tcC5qcyJdLCJuYW1lcyI6WyJ1dGlscyIsInJlcXVpcmUiLCJyZXBlYXQiLCJSZWFjdCIsIlNuYWtlQ29tcCIsIndpbmRvd1NpemUiLCJzaXplIiwiaGVpZ2h0Iiwic2NvcmUiLCJoZWFkIiwiYm9keSIsImJvcmRlcnMiLCJjZW50ZXIiLCJNYXRoIiwiZmxvb3IiLCJ3aWR0aCIsImxlbiIsImRpcmVjdGlvbiIsInBvc2l0aW9uIiwiYm9hcmQiLCJyZW5kZXIiLCJybCIsIm91dHB1dCIsInVubXV0ZSIsImNsZWFyU2NyZWVuIiwidG9wIiwibGVmdCIsInJvdyIsImxlbmd0aCIsImNvbCIsInJpZ2h0IiwiYm90dG9tIiwid3JpdGUiLCJtdXRlIiwibW92ZSIsImV2ZW50Iiwia2V5IiwibmFtZSIsInJlc2V0IiwiQXJyYXkiLCJpIiwiaiIsInRpY2siLCJwdXNoIiwic2xpY2UiLCJyZWR1Y2UiLCJhY2MiLCJjdXJyIiwiYXJyIiwidGFpbCIsInByZXYiLCJuZXh0IiwibWlkZGxlIiwibWlkIiwidW5zaGlmdCIsInBhcnQiLCJwb3AiLCJhcHBsZSIsIngiLCJyYW5kb20iLCJ5IiwiY3JlYXRlSW50ZXJmYWNlIiwiY2xpV2lkdGgiLCJzZXRQcm9tcHQiLCJoaWRlQ3Vyc29yIiwiaW5wdXQiLCJvbiIsInN0ciIsIm5vcm1hbGl6ZSIsImxpbmUiLCJjb25zb2xlIiwibG9nIiwic2V0SW50ZXJ2YWwiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFDQSxJQUFJQSxLQUFLLEdBQUdDLE9BQU8sQ0FBQyxnQkFBRCxDQUFuQjs7QUFDQSxJQUFJQyxNQUFNLEdBQUdELE9BQU8sQ0FBQyxlQUFELENBQXBCOztBQUNBLE1BQU1FLEtBQUssR0FBR0YsT0FBTyxDQUFDLE9BQUQsQ0FBckI7O0FBRUEsTUFBTUcsU0FBUyxHQUFHLE1BQU07QUFDdEIsTUFBSUMsVUFBVSxHQUFHSixPQUFPLENBQUMsYUFBRCxDQUF4Qjs7QUFDQSxNQUFJSyxJ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LE1BQUlyQyxFQUFFLEdBQUdyQixLQUFLLENBQUM2RCxlQUFOLEVBQVQ7QUFDQSxNQUFJOUMsS0FBSyxHQUFHZixLQUFLLENBQUM4RCxRQUFOLENBQWV6QyxFQUFmLENBQVo7QUFDQUEsRUFBQUEsRUFBRSxDQUFDMEMsU0FBSCxDQUFhLEVBQWI7QUFDQS9ELEVBQUFBLEtBQUssQ0FBQ2dFLFVBQU4sQ0FBaUIzQyxFQUFqQjtBQUVBQSxFQUFBQSxFQUFFLENBQUM0QyxLQUFILENBQVNDLEVBQVQsQ0FBWSxVQUFaLEVBQXdCLFVBQVNDLEdBQVQsRUFBYy9CLEdBQWQsRUFBbUI7QUFDekMsUUFBSUQsS0FBSyxHQUFHbkMsS0FBSyxDQUFDb0UsU0FBTixDQUFnQkQsR0FBaEIsRUFBcUIvQixHQUFyQixDQUFaO0FBQ0FGLElBQUFBLElBQUksQ0FBQ0MsS0FBRCxDQUFKO0FBQ0QsR0FIRDtBQUtBZCxFQUFBQSxFQUFFLENBQUM2QyxFQUFILENBQU0sTUFBTixFQUFjLFVBQVNHLElBQVQsRUFBZTtBQUMzQkMsSUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksTUFBWixFQUFvQkYsSUFBcEI7QUFDRCxHQUZEO0FBSUFoRCxFQUFBQSxFQUFFLENBQUNDLE1BQUgsQ0FBVVcsSUFBVjtBQUNBSyxFQUFBQSxLQUFLO0FBQ0xsQixFQUFBQSxNQUFNO0FBRU5vRCxFQUFBQSxXQUFXLENBQUM5QixJQUFELEVBQU8sR0FBUCxDQUFYO0FBQ0E4QixFQUFBQSxXQUFXLENBQUNmLEtBQUQsRUFBUSxJQUFSLENBQVg7QUFFRCxDQWpNRDs7QUFtTUFnQixNQUFNLENBQUNDLE9BQVAsR0FBaUJ0RSxTQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbnZhciB1dGlscyA9IHJlcXVpcmUoJ3JlYWRsaW5lLXV0aWxzJyk7XG52YXIgcmVwZWF0ID0gcmVxdWlyZSgncmVwZWF0LXN0cmluZycpO1xuY29uc3QgUmVhY3QgPSByZXF1aXJlKFwicmVhY3RcIik7XG5cbmNvbnN0IFNuYWtlQ29tcCA9ICgpID0+IHtcbiAgdmFyIHdpbmRvd1NpemUgPSByZXF1aXJlKCd3aW5kb3ctc2l6ZScpO1xuICB2YXIgc2l6ZSA9IHdpbmRvd1NpemUuaGVpZ2h0IC0gMTA7XG4gIHZhciBzY29yZSA9IDA7XG4gIHZhciBoZWFkID0gJ14nO1xuICB2YXIgYm9keSA9IFtdO1xuXG4gIC8vIGJvcmRlcnMgYXJlIGZyb20gY2xpLXRhYmxlIGNoYXJzOiBodHRwczovL2dpdGh1Yi5jb20vQXV0b21hdHRpYy9jbGktdGFibGUvYmxvYi9tYXN0ZXIvbGliL2luZGV4LmpzI0wyMS1MMzdcbiAgdmFyIGJvcmRlcnMgPSB7XG4gICAgJ3RvcCc6ICfilIAnLFxuICAgICd0b3AtbWlkJzogJ+KUrCcsXG4gICAgJ3RvcC1sZWZ0JzogJ+KUjCcsXG4gICAgJ3RvcC1yaWdodCc6ICfilJAnLFxuICAgICdib3R0b20nOiAn4pSAJyxcbiAgICAnYm90dG9tLW1pZCc6ICfilLQnLFxuICAgICdib3R0b20tbGVmdCc6ICfilJQnLFxuICAgICdib3R0b20tcmlnaHQnOiAn4pSYJyxcbiAgICAnbGVmdCc6ICfilIInLFxuICAgICdsZWZ0LW1pZCc6ICfilJwnLFxuICAgICdtaWQnOiAn4pSAJyxcbiAgICAnbWlkLW1pZCc6ICfilLwnLFxuICAgICdyaWdodCc6ICfilIInLFxuICAgICdyaWdodC1taWQnOiAn4pSkJyxcbiAgICAnbWlkZGxlJzogJ+KUgidcbiAgfTtcblxuICB2YXIgY2VudGVyID0gW1xuICAgIE1hdGguZmxvb3Iod2luZG93U2l6ZS53aWR0aCAvIDIpLFxuICAgIE1hdGguZmxvb3Iod2luZG93U2l6ZS5oZWlnaHQgLyAyKVxuICBdO1xuXG4gIHZhciBsZW4gPSAxO1xuICB2YXIgZGlyZWN0aW9uID0gWzAsIC0xXTtcbiAgdmFyIHBvc2l0aW9uLCBib2FyZDtcblxuICBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgcmwub3V0cHV0LnVubXV0ZSgpO1xuICAgIHV0aWxzLmNsZWFyU2NyZWVuKHJsKTtcblxuICAgIHZhciBvdXRwdXQgPSAnJztcbiAgICB2YXIgdG9wID0gY2VudGVyWzFdIC0gTWF0aC5mbG9vcihzaXplIC8gMik7XG4gICAgdmFyIGxlZnQgPSBjZW50ZXJbMF0gLSBzaXplO1xuICAgIG91dHB1dCArPSAnXFxuJyArIHJlcGVhdCgnICcsIGxlZnQpICsgc2NvcmUgKyAnXFxuJztcbiAgICBvdXRwdXQgKz0gcmVwZWF0KCdcXG4nLCB0b3AgLSAyKTtcbiAgICBvdXRwdXQgKz0gcmVwZWF0KCcgJywgbGVmdCk7XG4gICAgb3V0cHV0ICs9IGJvcmRlcnNbJ3RvcC1sZWZ0J10gKyByZXBlYXQoYm9yZGVycy50b3AsIChzaXplICogMikpICsgYm9yZGVyc1sndG9wLXJpZ2h0J10gKyAnXFxuJztcblxuICAgIGZvciAodmFyIHJvdyA9IDA7IHJvdyA8IGJvYXJkLmxlbmd0aDsgcm93KyspIHtcbiAgICAgIG91dHB1dCArPSByZXBlYXQoJyAnLCBsZWZ0KSArIGJvcmRlcnMubGVmdDtcbiAgICAgIGZvciAodmFyIGNvbCA9IDA7IGNvbCA8IGJvYXJkW3Jvd10ubGVuZ3RoOyBjb2wrKykge1xuICAgICAgICBvdXRwdXQgKz0gJyAnICsgYm9hcmRbcm93XVtjb2xdO1xuICAgICAgfVxuICAgICAgb3V0cHV0ICs9IGJvcmRlcnMucmlnaHQgKyAnXFxuJztcbiAgICB9XG4gICAgb3V0cHV0ICs9IHJlcGVhdCgnICcsIGxlZnQpO1xuICAgIG91dHB1dCArPSBib3JkZXJzWydib3R0b20tbGVmdCddICsgcmVwZWF0KGJvcmRlcnMuYm90dG9tLCAoc2l6ZSAqIDIpKSArIGJvcmRlcnNbJ2JvdHRvbS1yaWdodCddICsgJ1xcbic7XG5cbiAgICBybC5vdXRwdXQud3JpdGUob3V0cHV0KTtcbiAgICBybC5vdXRwdXQubXV0ZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gbW92ZShldmVudCkge1xuICAgIGlmICghZXZlbnQpIHJldHVybjtcbiAgICBzd2l0Y2ggKGV2ZW50LmtleS5uYW1lKSB7XG4gICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgIGRpcmVjdGlvbiA9IFsxLCAwXTtcbiAgICAgICAgaGVhZCA9ICc+JztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdsZWZ0JzpcbiAgICAgICAgZGlyZWN0aW9uID0gWy0xLCAwXTtcbiAgICAgICAgaGVhZCA9ICc8JztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICd1cCc6XG4gICAgICAgIGRpcmVjdGlvbiA9IFswLCAtMV07XG4gICAgICAgIGhlYWQgPSAnXic7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnZG93bic6XG4gICAgICAgIGRpcmVjdGlvbiA9IFswLCAxXTtcbiAgICAgICAgaGVhZCA9ICd2JztcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgc2NvcmUgPSAwO1xuICAgIGxlbiA9IDE7XG4gICAgYm9keSA9IFtdO1xuICAgIHBvc2l0aW9uID0gW1xuICAgICAgTWF0aC5mbG9vcihzaXplIC8gMiksXG4gICAgICBNYXRoLmZsb29yKHNpemUgLyAyKVxuICAgIF07XG5cbiAgICBib2FyZCA9IG5ldyBBcnJheShzaXplKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJvYXJkLmxlbmd0aDsgaSsrKSB7XG4gICAgICBib2FyZFtpXSA9IG5ldyBBcnJheShzaXplKTtcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgYm9hcmRbaV0ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgYm9hcmRbaV1bal0gPSAnICc7XG4gICAgICB9XG4gICAgfVxuICAgIGJvYXJkW3Bvc2l0aW9uWzFdXVtwb3NpdGlvblswXV0gPSBoZWFkO1xuICB9XG5cbiAgZnVuY3Rpb24gdGljaygpIHtcbiAgICBib2FyZFtwb3NpdGlvblsxXV1bcG9zaXRpb25bMF1dID0gJyAnO1xuICAgIHBvc2l0aW9uWzBdICs9IGRpcmVjdGlvblswXTtcbiAgICBwb3NpdGlvblsxXSArPSBkaXJlY3Rpb25bMV07XG5cbiAgICBpZiAocG9zaXRpb25bMF0gPj0gc2l6ZSB8fCBwb3NpdGlvblsxXSA+PSBzaXplIHx8IHBvc2l0aW9uWzBdIDwgMCB8fCBwb3NpdGlvblsxXSA8IDApIHtcbiAgICAgIHJlc2V0KCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGJvYXJkW3Bvc2l0aW9uWzFdXVtwb3NpdGlvblswXV0gPT09ICdAJykge1xuICAgICAgc2NvcmUrKztcbiAgICAgIGxlbisrO1xuICAgICAgaWYgKGJvZHkubGVuZ3RoKSB7XG4gICAgICAgIGJvZHkucHVzaChwb3NpdGlvbi5zbGljZSgpKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGJvYXJkW3Bvc2l0aW9uWzFdXVtwb3NpdGlvblswXV0gIT09ICcgJykge1xuICAgICAgcmVzZXQoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBib2FyZFtwb3NpdGlvblsxXV1bcG9zaXRpb25bMF1dID0gaGVhZDtcbiAgICBib2R5LnJlZHVjZShmdW5jdGlvbihhY2MsIGN1cnIsIGksIGFycikge1xuICAgICAgdmFyIHRhaWwgPSAnWCc7XG4gICAgICB2YXIgcHJldiA9IChpID09PSAwID8gcG9zaXRpb24gOiBhcnJbaSAtIDFdKTtcbiAgICAgIHZhciBuZXh0ID0gKGkgPT09IGFyci5sZW5ndGggLSAxID8gbnVsbCA6IGFycltpICsgMV0pO1xuICAgICAgaWYgKHByZXZbMF0gPT09IGN1cnJbMF0pIHtcbiAgICAgICAgaWYgKG5leHQpIHtcbiAgICAgICAgICBpZiAobmV4dFswXSA9PT0gY3VyclswXSkgdGFpbCA9IGJvcmRlcnMubWlkZGxlO1xuICAgICAgICAgIGVsc2UgaWYgKG5leHRbMF0gPiBjdXJyWzBdKSB7XG4gICAgICAgICAgICBpZiAocHJldlsxXSA8IGN1cnJbMV0pIHRhaWwgPSBib3JkZXJzWydib3R0b20tbGVmdCddO1xuICAgICAgICAgICAgZWxzZSB0YWlsID0gYm9yZGVyc1sndG9wLWxlZnQnXTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHByZXZbMV0gPCBjdXJyWzFdKSB0YWlsID0gYm9yZGVyc1snYm90dG9tLXJpZ2h0J107XG4gICAgICAgICAgICBlbHNlIHRhaWwgPSBib3JkZXJzWyd0b3AtcmlnaHQnXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGFpbCA9IGJvcmRlcnMubWlkZGxlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHByZXZbMV0gPT09IGN1cnJbMV0pIHtcbiAgICAgICAgaWYgKG5leHQpIHtcbiAgICAgICAgICBpZiAobmV4dFsxXSA9PT0gY3VyclsxXSkgdGFpbCA9IGJvcmRlcnMubWlkO1xuICAgICAgICAgIGVsc2UgaWYgKG5leHRbMV0gPiBjdXJyWzFdKSB7XG4gICAgICAgICAgICBpZiAocHJldlswXSA+IGN1cnJbMF0pIHRhaWwgPSBib3JkZXJzWyd0b3AtbGVmdCddO1xuICAgICAgICAgICAgZWxzZSB0YWlsID0gYm9yZGVyc1sndG9wLXJpZ2h0J107XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChwcmV2WzBdID4gY3VyclswXSkgdGFpbCA9IGJvcmRlcnNbJ2JvdHRvbS1sZWZ0J107XG4gICAgICAgICAgICBlbHNlIHRhaWwgPSBib3JkZXJzWydib3R0b20tcmlnaHQnXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGFpbCA9IGJvcmRlcnMubWlkO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBib2FyZFtjdXJyWzFdXVtjdXJyWzBdXSA9IHRhaWw7XG4gICAgfSwgW10pO1xuXG4gICAgYm9keS51bnNoaWZ0KHBvc2l0aW9uLnNsaWNlKCkpO1xuICAgIHdoaWxlIChib2R5Lmxlbmd0aCA+IGxlbikge1xuICAgICAgdmFyIHBhcnQgPSBib2R5LnBvcCgpO1xuICAgICAgYm9hcmRbcGFydFsxXV1bcGFydFswXV0gPSAnICc7XG4gICAgfVxuICAgIHJlbmRlcigpO1xuICB9XG5cbiAgZnVuY3Rpb24gYXBwbGUoKSB7XG4gICAgdmFyIHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBzaXplKTtcbiAgICB2YXIgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHNpemUpO1xuICAgIGJvYXJkW3ldW3hdID0gJ0AnO1xuICB9XG5cbiAgdmFyIHJsID0gdXRpbHMuY3JlYXRlSW50ZXJmYWNlKCk7XG4gIHZhciB3aWR0aCA9IHV0aWxzLmNsaVdpZHRoKHJsKTtcbiAgcmwuc2V0UHJvbXB0KCcnKTtcbiAgdXRpbHMuaGlkZUN1cnNvcihybCk7XG5cbiAgcmwuaW5wdXQub24oJ2tleXByZXNzJywgZnVuY3Rpb24oc3RyLCBrZXkpIHtcbiAgICB2YXIgZXZlbnQgPSB1dGlscy5ub3JtYWxpemUoc3RyLCBrZXkpO1xuICAgIG1vdmUoZXZlbnQpO1xuICB9KTtcblxuICBybC5vbignbGluZScsIGZ1bmN0aW9uKGxpbmUpIHtcbiAgICBjb25zb2xlLmxvZygnbGluZScsIGxpbmUpO1xuICB9KTtcblxuICBybC5vdXRwdXQubXV0ZSgpO1xuICByZXNldCgpO1xuICByZW5kZXIoKTtcblxuICBzZXRJbnRlcnZhbCh0aWNrLCAyMDApO1xuICBzZXRJbnRlcnZhbChhcHBsZSwgMjAwMCk7XG5cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU25ha2VDb21wO1xuIl19